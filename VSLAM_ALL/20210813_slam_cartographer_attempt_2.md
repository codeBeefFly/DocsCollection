# 2021年08月13日：cartographer_ws compiling failure, attempt 2.

[toc]

---

log: 2021年08月13日：

reference to **2021年08月11日：安装运行 ros slam cartographer**, reinstall cartographer and cartographer_ros.

完成 cartographer 的 2d，3d ros bag 的运行，但是还是需要总结 cartographer 的安装部分（如果需要使用 cartographer 作为建图的初始框架，需要能重复稳定的安装流程）

log: 2021年08月17日：

回顾 0813 的结果，查看 ros bag 的运行代码。

---

## 1. installation stage

```
mkdir catkin_ws
cd catkin_ws
wstool init src
wstool merge -t src https://raw.githubusercontent.com/cartographer-project/cartographer_ros/master/cartographer_ros.rosinstall
wstool update -t src
```

gedit src/.rosinstall 查看内容
```
# THIS IS AN AUTOGENERATED FILE, LAST GENERATED USING wstool ON 2021-08-13
- git:
    local-name: cartographer
    uri: https://github.com/cartographer-project/cartographer.git
    version: master
- git:
    local-name: cartographer_ros
    uri: https://github.com/cartographer-project/cartographer_ros.git
    version: master
```

![image-20210813133203141](20210813_slam_cartographer_attempt_2.assets/image-20210813133203141.png)

<img src="20210813_slam_cartographer_attempt_2.assets/image-20210813133217628.png" alt="image-20210813133217628" style="zoom:100%;float:left" />

如果官网安装方式不成功的话，可以尝试一下独立安装。



2021年08月13日：编译成功：

```
[50/384] Building CXX object CMakeFiles/cartographer.dir/cartographer/io/coloring_points_processor.cc.o
[51/384] Building CXX object CMakeFiles/cartographer.dir/cartographer/io/probability_grid_points_processor.cc.o
FAILED: /usr/bin/c++   -D__CLANG_SUPPORT_DYN_ANNOTATION__ -isystem /usr/include/eigen3 -isystem /usr/local/include -isystem /usr/include/lua5.2 -I. -I/home/ds16v2/catkin_x/cartographer_ws/src/cartographer -O3 -DNDEBUG    -pthread -fPIC  -Wall -Wpedantic -Werror=format-security -Werror=missing-braces -Werror=reorder -Werror=return-type -Werror=switch -Werror=uninitialized -O3 -DNDEBUG -MMD -MT CMakeFiles/cartographer.dir/cartographer/mapping/internal/trajectory_connectivity_state.cc.o -MF CMakeFiles/cartographer.dir/cartographer/mapping/internal/trajectory_connectivity_state.cc.o.d -o CMakeFiles/cartographer.dir/cartographer/mapping/internal/trajectory_connectivity_state.cc.o -c /home/ds16v2/catkin_x/cartographer_ws/src/cartographer/cartographer/mapping/internal/trajectory_connectivity_state.cc
In file included from /usr/include/c++/5/chrono:35:0,
                 from /home/ds16v2/catkin_x/cartographer_ws/src/cartographer/cartographer/common/time.h:20,
                 from /home/ds16v2/catkin_x/cartographer_ws/src/cartographer/cartographer/mapping/internal/trajectory_connectivity_state.h:20,
                 from /home/ds16v2/catkin_x/cartographer_ws/src/cartographer/cartographer/mapping/internal/trajectory_connectivity_state.cc:17:
/usr/include/c++/5/bits/c++0x_warning.h:32:2: error: #error This file requires compiler and library support for the ISO C++ 2011 standard. This support must be enabled with the -std=c++11 or -std=gnu++11 compiler options.
 #error This file requires compiler and library support \
```

在三个文件包的 CMakeLists.txt 中添加：`set(CMAKE_CXX_STANDARD 11)`

编译完成：（哇啊啊）

```
-- Installing: /home/ds16v2/catkin_x/cartographer_ws/install_isolated/lib/cmake/Ceres/CeresTargets.cmake
-- Installing: /home/ds16v2/catkin_x/cartographer_ws/install_isolated/lib/cmake/Ceres/CeresTargets-release.cmake
-- Installing: /home/ds16v2/catkin_x/cartographer_ws/install_isolated/lib/cmake/Ceres/CeresConfig.cmake
-- Installing: /home/ds16v2/catkin_x/cartographer_ws/install_isolated/lib/cmake/Ceres/CeresConfigVersion.cmake
-- Installing: /home/ds16v2/catkin_x/cartographer_ws/install_isolated/lib/cmake/Ceres/FindEigen.cmake
-- Installing: /home/ds16v2/catkin_x/cartographer_ws/install_isolated/lib/cmake/Ceres/FindGlog.cmake
-- Installing: /home/ds16v2/catkin_x/cartographer_ws/install_isolated/lib/cmake/Ceres/FindGflags.cmake
-- Installing: /home/ds16v2/catkin_x/cartographer_ws/install_isolated/lib/libceres.a
<== Finished processing package [5 of 5]: 'ceres-solver'
ds16v2@ds16v2:~/catkin_x/cartographer_ws$ 
```

编译 1：cartographer：

![image-20210813175934310](20210813_slam_cartographer_attempt_2.assets/image-20210813175934310.png)

编译 2：cartographer_ros_msgs：

![image-20210813180002381](20210813_slam_cartographer_attempt_2.assets/image-20210813180002381.png)

编译 3：cartographer_ros：

![image-20210813180031245](20210813_slam_cartographer_attempt_2.assets/image-20210813180031245.png)

编译 4：cartographer_rviz：

![image-20210813180116738](20210813_slam_cartographer_attempt_2.assets/image-20210813180116738.png)

编译 5：ceres-solver：

![image-20210813180155672](20210813_slam_cartographer_attempt_2.assets/image-20210813180155672.png)

![image-20210813180233631](20210813_slam_cartographer_attempt_2.assets/image-20210813180233631.png)

完成编译。



#### reference

link: [cartographer安装报错及解决方法<这个博主的经历可以借鉴一下>](https://blog.csdn.net/qq_41314627/article/details/105606901?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_title~default-0.control&spm=1001.2101.3001.4242)



---

## 2. implementation stage: ros bag

![image-20210813182407712](20210813_slam_cartographer_attempt_2.assets/image-20210813182407712.png)

![image-20210813182435066](20210813_slam_cartographer_attempt_2.assets/image-20210813182435066.png)

错误：

```
started core service [/rosout]
ERROR: cannot launch node of type [robot_state_publisher/robot_state_publisher]: robot_state_publisher
ROS path [0]=/opt/ros/kinetic/share/ros
ROS path [1]=/home/ds16v2/catkin_x/cartographer_ws/install_isolated/share
ROS path [2]=/opt/ros/kinetic/share


[FATAL] [1628850179.661537755]: Error opening file: /home/ds16v2/Downloads/cartographer_paper_deutsche


[playbag-6] process has died [pid 17492, exit code 1, cmd /opt/ros/kinetic/lib/rosbag/play --clock /home/ds16v2/Downloads/cartographer_paper_deutsche __name:=playbag __log:=/home/ds16v2/.ros/log/6e8df6f8-fc20-11eb-a857-a0c589ac1e85/playbag-6.log].
log file: /home/ds16v2/.ros/log/6e8df6f8-fc20-11eb-a857-a0c589ac1e85/playbag-6*.log
```

![image-20210813182622399](20210813_slam_cartographer_attempt_2.assets/image-20210813182622399.png)



### 1. successfully run cartographer ros bag

with the help of doctor Lin. 

成功运行 demo_2d.bag：

回环检测很耗时间。

```
ds16v2@ds16v2:~/catkin_x/cartographer_ws$ roslaunch cartographer_ros demo_backpack_2d.launch bag_filename:=/home/ds16v2/Downloads/cartographer_paper_deutsches_museum.bag
```

![image-20210813212618869](20210813_slam_cartographer_attempt_2.assets/image-20210813212618869.png)



成功运行 demo_3d.bag：

3D 包含了高度信息。

```
roslaunch cartographer_ros demo_backpack_3d.launch bag_filename:=${HOME}/Downloads/b3-2016-04-05-14-14-00.bag
```

![image-20210813215846984](20210813_slam_cartographer_attempt_2.assets/image-20210813215846984.png)

![image-20210813220010516](20210813_slam_cartographer_attempt_2.assets/image-20210813220010516.png)

![image-20210813220654595](20210813_slam_cartographer_attempt_2.assets/image-20210813220654595.png)



#### reference

1. [google激光雷达slam算法Cartographer的安装及bag包demo测试](http://community.bwbot.org/topic/136/google%E6%BF%80%E5%85%89%E9%9B%B7%E8%BE%BEslam%E7%AE%97%E6%B3%95cartographer%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8Abag%E5%8C%85demo%E6%B5%8B%E8%AF%95)



### 2. more on 2d & 3d ros bag

用 clion 打开 cartographer_ros 中的 CMakeLists.txt。会出现报错：

![image-20210817111116305](20210813_slam_cartographer_attempt_2.assets/image-20210817111116305.png)

注释掉 51，52：

![image-20210817111205242](20210813_slam_cartographer_attempt_2.assets/image-20210817111205242.png)

可以构建通过，但是会有 Warning。



继续进行 offline_2d_demo，建图完成时间：`3:19:01`：

![image-20210817145345781](20210813_slam_cartographer_attempt_2.assets/image-20210817145345781.png)

![image-20210817145407239](20210813_slam_cartographer_attempt_2.assets/image-20210817145407239.png)

```
[ INFO] [1629182948.110859934, 1432648928.455170700]: I0817 14:49:08.000000  5630 offline_node.cc:376] Peak memory usage: 2273728 KiB
[ INFO] [1629182948.110903660, 1432648928.455170700]: I0817 14:49:08.000000  5630 offline_node.cc:386] Writing state to '/home/ds16v2/catkin_x/cartographer_ws/ros_bag/cartographer_paper_deutsches_museum.bag.pbstream'...
[ INFO] [1629182963.438791421, 1432648928.455170700]: I0817 14:49:23.000000  5674 constraint_builder_2d.cc:290] 0 computations resulted in 0 additional constraints.
[ INFO] [1629182963.439976532, 1432648928.455170700]: I0817 14:49:23.000000  5674 constraint_builder_2d.cc:292] Score histogram:
Count: 23605  Min: 0.550012  Max: 0.876664  Mean: 0.63404
[0.550012, 0.582677)	               #####	Count: 6232 (26.4012%)	Total: 6232 (26.4012%)
[0.582677, 0.615342)	                ####	Count: 5188 (21.9784%)	Total: 11420 (48.3796%)
[0.615342, 0.648008)	                 ###	Count: 3830 (16.2254%)	Total: 15250 (64.605%)
[0.648008, 0.680673)	                 ###	Count: 2973 (12.5948%)	Total: 18223 (77.1997%)
[0.680673, 0.713338)	                  ##	Count: 2136 (9.04893%)	Total: 20359 (86.2487%)
[0.713338, 0.746003)	                   #	Count: 1507 (6.38424%)	Total: 21866 (92.6329%)
[0.746003, 0.778668)	                   #	Count: 919 (3.89324%)	Total: 22785 (96.5262%)
[0.778668, 0.811333)	                    	Count: 517 (2.19021%)	Total: 23302 (98.7164%)
[0.811333, 0.843998)	                    	Count: 242 (1.02521%)	Total: 23544 (99.7416%)
[0.843998, 0.876664]	                    	Count: 61 (0.25842%)	Total: 23605 (100%)
Optimizing: Done.     
[cartographer_offline_node-4] process has finished cleanly
log file: /home/ds16v2/.ros/log/783f1bda-ff0b-11eb-aff9-a0c589ac1e85/cartographer_offline_node-4*.log
```

结束 demo：

![image-20210817150530652](20210813_slam_cartographer_attempt_2.assets/image-20210817150530652.png)

生成 `.pbstream`格式文件，地图文件：

<img src="20210813_slam_cartographer_attempt_2.assets/image-20210817145450832.png" alt="image-20210817145450832" style="zoom:100%;float:left" />



生成 `.pgm & .yaml` 文件：

```
ds16v2@ds16v2:~/catkin_x/cartographer_ws$ roslaunch cartographer_ros assets_writer_ros_map.launch bag_filenames:=/home/ds16v2/catkin_x/cartographer_ws/ros_bag/cartographer_paper_deutsches_museum.bag pose_graph_filename:=/home/ds16v2/catkin_x/cartographer_ws/ros_bag/cartographer_paper_deutsches_museum.bag.pbstream 
```

![image-20210817153833181](20210813_slam_cartographer_attempt_2.assets/image-20210817153833181.png)

![image-20210817153803796](20210813_slam_cartographer_attempt_2.assets/image-20210817153803796.png)

<img src="20210813_slam_cartographer_attempt_2.assets/image-20210817154001387.png" alt="image-20210817154001387" style="zoom:100%;float:left" />

<img src="20210813_slam_cartographer_attempt_2.assets/image-20210817153923806.png" alt="image-20210817153923806" style="zoom:100%;float:left" />

![image-20210817154042282](20210813_slam_cartographer_attempt_2.assets/image-20210817154042282.png)



#### reference

link: [BluewhaleRobot](https://github.com/BluewhaleRobot)/**[xq-manual](https://github.com/BluewhaleRobot/xq-manual)**

link: [3d map rendering<关于Cartographer 3D建图>](https://github.com/cartographer-project/cartographer_ros/issues/1168)





### 3. more on 2d rosbag, offical tutorial

![image-20210817162023554](20210813_slam_cartographer_attempt_2.assets/image-20210817162023554.png)



很奇怪，为什么终端没有输出（是在进行计算还是程序终止？）：

可以看到 `Remaining work items in queue: 1169`，说明工作序列中还有 1169 待处理任务。

```
[ INFO] [1629190989.455616836, 1461761183.726254938]: I0817 17:03:09.000000 12074 constraint_builder_2d.cc:290] 52 computations resulted in 10 additional constraints.
[ INFO] [1629190989.456811233, 1461761183.726254938]: I0817 17:03:09.000000 12074 constraint_builder_2d.cc:292] Score histogram:
Count: 13956  Min: 0.550034  Max: 0.871112  Mean: 0.653867
[0.550034, 0.582142)	                 ###	Count: 2377 (17.0321%)	Total: 2377 (17.0321%)
[0.582142, 0.614250)	                 ###	Count: 2391 (17.1324%)	Total: 4768 (34.1645%)
[0.614250, 0.646357)	                 ###	Count: 2254 (16.1508%)	Total: 7022 (50.3153%)
[0.646357, 0.678465)	                 ###	Count: 2104 (15.076%)	Total: 9126 (65.3912%)
[0.678465, 0.710573)	                 ###	Count: 1802 (12.912%)	Total: 10928 (78.3032%)
[0.710573, 0.742681)	                  ##	Count: 1406 (10.0745%)	Total: 12334 (88.3778%)
[0.742681, 0.774789)	                   #	Count: 833 (5.96876%)	Total: 13167 (94.3465%)
[0.774789, 0.806897)	                   #	Count: 493 (3.53253%)	Total: 13660 (97.8791%)
[0.806897, 0.839005)	                    	Count: 230 (1.64804%)	Total: 13890 (99.5271%)
[0.839005, 0.871112]	                    	Count: 66 (0.472915%)	Total: 13956 (100%)
[ INFO] [1629190989.481705394, 1461761183.726254938]: I0817 17:03:09.000000 12074 pose_graph_2d.cc:538] Remaining work items in queue: 1169
[ INFO] [1629190989.618453478, 1461761183.726254938]: I0817 17:03:09.000000 12073 constraint_builder_2d.cc:275] Node (1, 16174) with 206 points on submap (0, 51) differs by translation 0.03 rotation 0.005 with score 58.7%.
```

![image-20210817171414753](20210813_slam_cartographer_attempt_2.assets/image-20210817171414753.png)

需要了解 cartographer 的终止条件是什么？

![image-20210817171520170](20210813_slam_cartographer_attempt_2.assets/image-20210817171520170.png)

这个是 Pure localiztion 的处理结果。



#### Issue: required process cartographer_assets_writer-2 has died!

在将 .pbstream 文件转化为 .pgm 与 .yaml 文件时，会出现这个问题。

![image-20210817200143151](20210813_slam_cartographer_attempt_2.assets/image-20210817200143151.png)

这个问题暂时没有找到解决办法，先跳过。

晚上先看完 cartographer 的教程吧。（xxxx google 太 xxxx）

---

## 3. vpn stuff

官网安装步骤：[https://windscribe.com/guides/linux](https://windscribe.com/guides/linux)

![image-20210813140428097](20210813_slam_cartographer_attempt_2.assets/image-20210813140428097.png)

安装成功，但是这个vpn似乎不给力：

安装步骤：

问题：`Failed to fetch https://repo.windscribe.com/ubuntu/dists/bionic/InRelease`

```
ds16v2@ds16v2:~$ sudo apt-get update
Hit:1 http://packages.ros.org/ros/ubuntu xenial InRelease
Hit:2 https://typora.io/linux ./ InRelease
Hit:3 https://esm.ubuntu.com/infra/ubuntu xenial-infra-security InRelease
Hit:4 https://esm.ubuntu.com/infra/ubuntu xenial-infra-updates InRelease
Get:5 https://download.docker.com/linux/ubuntu xenial InRelease [66.2 kB]
Hit:6 http://ppa.launchpad.net/git-core/ppa/ubuntu xenial InRelease
Hit:7 http://ppa.launchpad.net/graphics-drivers/ppa/ubuntu xenial InRelease   
Hit:8 http://ppa.launchpad.net/maarten-baert/simplescreenrecorder/ubuntu xenial InRelease   
Hit:9 http://ppa.launchpad.net/nilarimogard/webupd8/ubuntu xenial InRelease                 
Hit:10 http://ppa.launchpad.net/obsproject/obs-studio/ubuntu xenial InRelease               
Hit:11 http://ppa.launchpad.net/ubuntu-toolchain-r/test/ubuntu xenial InRelease             
Hit:12 http://ppa.launchpad.net/ubuntu-x-swat/updates/ubuntu xenial InRelease               
Hit:13 http://mirrors.ustc.edu.cn/ubuntu xenial InRelease                                   
Hit:14 http://mirrors.ustc.edu.cn/ubuntu xenial-updates InRelease                           
Hit:15 http://mirrors.ustc.edu.cn/ubuntu xenial-backports InRelease                         
Hit:16 http://mirrors.ustc.edu.cn/ubuntu xenial-security InRelease                          
Hit:17 http://packages.osrfoundation.org/gazebo/ubuntu-stable xenial InRelease              
Err:18 https://repo.windscribe.com/ubuntu bionic InRelease
  Connection timed out after 120001 milliseconds
Fetched 66.2 kB in 2min 0s (551 B/s)
Reading package lists... Done
W: Failed to fetch https://repo.windscribe.com/ubuntu/dists/bionic/InRelease  Connection timed out after 120001 milliseconds
W: Some index files failed to download. They have been ignored, or old ones used instead.
ds16v2@ds16v2:~$ 

```

![image-20210813150751998](20210813_slam_cartographer_attempt_2.assets/image-20210813150751998.png)

解决：

<img src="20210813_slam_cartographer_attempt_2.assets/image-20210813151003016.png" alt="image-20210813151003016" style="zoom:100%;float:left" />

give me binaries:

![image-20210813151612850](20210813_slam_cartographer_attempt_2.assets/image-20210813151612850.png)

```
$ sudo dpkg -i windscribe-cli_1.4-51_amd64.deb
$ sudo apt install -f
$ sudo dpkg -i windscribe-cli_1.4-51_amd64.deb  # 其实不用这一步
```

![image-20210813151930796](20210813_slam_cartographer_attempt_2.assets/image-20210813151930796.png)

![image-20210813152025379](20210813_slam_cartographer_attempt_2.assets/image-20210813152025379.png)

```
name:	jacob_lee
passwd:	lijin890119
```

![image-20210813152117974](20210813_slam_cartographer_attempt_2.assets/image-20210813152117974.png)

安装好了，但是没有鸟用。
